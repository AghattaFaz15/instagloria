<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aghatta XV</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  background: url('imagem.png') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
  font-family:sans-serif;
}
.gold{color:#D4AF37;}
.card{backdrop-filter: blur(8px); background: rgba(10,14,30,.6); border-radius:1rem; padding:1rem; margin-bottom:1rem;}
button{cursor:pointer;}
textarea,input{background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.1); border-radius:0.75rem; padding:0.5rem; color:#fff; width:100%;}
a{color:#D4AF37;}
</style>
</head>
<body class="min-h-screen">
<header class="sticky top-0 z-20 bg-slate-900/80 backdrop-blur border-b border-white/10 p-4 flex justify-between items-center">
<h1 class="text-xl sm:text-2xl font-semibold gold">üïäÔ∏è Aghatta XV</h1>
</header>

<main class="max-w-3xl mx-auto px-4 py-6 space-y-6">

<!-- Formul√°rio de Post -->
<div class="card">
<h2 class="text-lg font-semibold mb-2 gold">Compartilhe sua mem√≥ria ‚ú®</h2>
<form id="postForm" class="space-y-3">
<input id="authorInput" type="text" placeholder="Seu nome" required />
<textarea id="captionInput" placeholder="Legenda (opcional)"></textarea>
<input id="fileInput" type="file" accept="image/*,video/*" required/>
<button type="submit" id="postBtn" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-xl gold">Postar</button>
<div id="uploadStatus" class="text-sm mt-1"></div>
<div id="preview" class="mt-2 aspect-video w-full bg-black/20 rounded-md grid place-items-center text-sm">Sem m√≠dia</div>
</form>
</div>

<!-- Feed -->
<div id="feed" class="space-y-4"></div>
<div id="emptyFeed" class="text-center opacity-70 mt-6 hidden">Seja o(a) primeiro(a) a postar ‚ú®</div>

<footer class="text-center text-xs opacity-60 py-10">
Feito com carinho para a Aghatta ‚Ä¢ <span class="gold">azul & dourado</span>
</footer>

<script>
const cloudName = 'dxobnhynf';
const uploadPreset = 'Default';

// UID local
const uid = (() => {
  const k = 'aghatta_uid';
  let v = localStorage.getItem(k);
  if (!v) { v = crypto.randomUUID(); localStorage.setItem(k,v); }
  return v;
})();

// Preview
const fileInput = document.getElementById('fileInput');
const preview = document.getElementById('preview');
fileInput.addEventListener('change', ()=>{
  const f = fileInput.files?.[0];
  if(!f){ preview.textContent='Sem m√≠dia'; return; }
  const url = URL.createObjectURL(f);
  const isVideo = f.type.startsWith('video/');
  preview.innerHTML = isVideo
    ? `<video src="${url}" class="w-full h-full object-cover rounded-md" controls></video>`
    : `<img src="${url}" class="w-full h-full object-cover rounded-md" alt="pr√©via"/>`;
});

// Postar
const postForm = document.getElementById('postForm');
const authorInput = document.getElementById('authorInput');
const captionInput = document.getElementById('captionInput');
const postBtn = document.getElementById('postBtn');
const uploadStatus = document.getElementById('uploadStatus');
const feed = document.getElementById('feed');
const emptyFeed = document.getElementById('emptyFeed');

function escapeHtml(str=''){return str.replace(/[&<>"']/g, (c)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}
function linkify(text=''){return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');}

postForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const file = fileInput.files?.[0];
  const author = authorInput.value.trim();
  const caption = captionInput.value.trim();
  if(!file || !author) return;
  postBtn.disabled=true;
  uploadStatus.textContent='Enviando‚Ä¶';
  try{
    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', uploadPreset);
    const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {method:'POST', body:formData});
    const data = await res.json();
    if(!data.secure_url) throw new Error('Falha no upload');
    const url = data.secure_url;
    const type = file.type.startsWith('video/')?'video':'image';

    // Salvar local
    let posts = JSON.parse(localStorage.getItem('posts')||'[]');
    posts.unshift({id:Date.now(),author,caption,url,type});
    localStorage.setItem('posts',JSON.stringify(posts));

    postForm.reset();
    preview.textContent='Sem m√≠dia';
    uploadStatus.textContent='Publicado!';
    renderFeed();
  }catch(err){console.error(err); uploadStatus.textContent='Falhou. Tente novamente.';}
  finally{postBtn.disabled=false;}
});

function renderFeed(){
  const posts = JSON.parse(localStorage.getItem('posts')||'[]');
  emptyFeed.classList.toggle('hidden',posts.length>0);
  feed.innerHTML = posts.map(p=>{
    const media = p.type==='video'
      ? `<video src="${p.url}" class="w-full rounded-md" controls playsinline></video>`
      : `<img src="${p.url}" class="w-full rounded-md"/>`;
    return `<div class="card">
      <div class="flex justify-between text-sm opacity-80 mb-1">
        <div>üë§ <strong>${escapeHtml(p.author)}</strong></div>
        <div>${new Date(p.id).toLocaleString()}</div>
      </div>
      ${media}
      ${p.caption?`<p class="mt-1">${linkify(escapeHtml(p.caption))}</p>`:''}
    </div>`;
  }).join('');
}

renderFeed();
</script>
</body>
</html>
